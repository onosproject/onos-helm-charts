# SPDX-FileCopyrightText: 2023-present Intel Corporation
#
# SPDX-License-Identifier: Apache-2.0

{{- if .Values.atomix.store.consensus.enabled }}
apiVersion: raft.atomix.io/v1beta3
kind: RaftStore
metadata:
  name: {{ template "onos-topo.fullname" . }}-consensus
  namespace: {{ .Release.Namespace }}
  labels:
    app: "{{ .Values.app_label }}-consensus"
    name: {{ template "onos-topo.fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
spec:
  cluster:
    name: {{ template "onos-topo.fullname" . }}-consensus
  partitions: {{ .Values.atomix.store.consensus.partitions }}
  {{- with .Values.atomix.store.consensus.config.raft.electionRTT }}
  electionRTT: {{ . }}
  {{- end }}
  {{- with .Values.atomix.store.consensus.config.raft.heartbeatRTT }}
  heartbeatRTT: {{ . }}
  {{- end }}
  {{- with .Values.atomix.store.consensus.config.raft.snapshotEntries }}
  snapshotEntries: {{ . }}
  {{- end }}
  {{- with .Values.atomix.store.consensus.config.raft.compactionOverhead }}
  compactionOverhead: {{ . }}
  {{- end }}
  {{- with .Values.atomix.store.consensus.config.raft.maxInMemLogSize }}
  maxInMemLogSize: {{ . }}
  {{- end }}